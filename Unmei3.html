<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Unmei - 出会いが鳴り、恋が奏でる運命</title>
  <style>
    :root { --gold:#ffd700; }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      height: 100vh;
      background: radial-gradient(circle at center, #1c0d0d 0%, #000000 80%);
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      font-family: 'Playfair Display', system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
    }

    h1 {
      font-size: clamp(40px, 8vw, 72px);
      color: var(--gold);
      text-shadow: 0 0 25px rgba(255, 215, 0, 1);
      letter-spacing: 3px;
      animation: fadeIn 1.8s ease forwards;
      margin: 24px 16px 8px;
    }

    p {
      font-size: clamp(14px, 2.5vw, 22px);
      color: var(--gold);
      letter-spacing: 2px;
      opacity: 0;
      animation: subtitle 1.6s ease forwards;
      animation-delay: 0.6s;
      text-shadow: 0 0 15px rgba(255,215,0,0.8);
      margin: 0 16px 8px;
      text-align: center;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes subtitle {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .keys {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 2px;
      padding: 8px 0 10px;
      pointer-events: none; /* クリックを邪魔しない */
    }

    .key {
      width: 64px;
      height: 280px;
      background: linear-gradient(to bottom, #fff, #ddd);
      border: 1px solid #444;
      border-radius: 4px;
      box-shadow: 0 4px 10px rgba(255,255,255,0.08);
      animation: play 6s infinite ease-in-out;
      position: relative;
    }
    .key.black {
      width: 42px;
      height: 180px;
      background: linear-gradient(to bottom, #111, #000);
      position: relative;
      top: 0;
      z-index: 2;
      margin-left: -21px;
      margin-right: -21px;
      animation: playBlack 6s infinite ease-in-out;
      border-color:#222;
      box-shadow: 0 4px 10px rgba(0,0,0,0.35);
    }

    @keyframes play {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.6); }
    }
    @keyframes playBlack {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.3); }
    }

    /* クリック時に一瞬光る */
    .flash { box-shadow: 0 0 22px rgba(255,215,0,0.9) !important; filter: brightness(2) saturate(1.2); }

    button.cta {
      position: relative;
      margin-top: clamp(16px, 6vh, 100px);
      background: linear-gradient(90deg, #8b0000, #b30000);
      color: var(--gold);
      border: 2px solid var(--gold);
      padding: 14px 36px;
      font-size: clamp(16px, 3.4vw, 24px);
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 0 25px rgba(255,215,0,0.35);
      transition: transform 0.25s ease, box-shadow 0.25s ease, filter 0.25s ease;
      text-shadow: 0 0 12px rgba(255,215,0,0.8);
      z-index: 5;
      backdrop-filter: blur(2px);
    }
    button.cta:hover {
      transform: translateY(-1px) scale(1.04);
      box-shadow: 0 0 35px rgba(255,215,0,0.8);
      filter: brightness(1.05);
    }
    button.cta:active {
      transform: translateY(0) scale(0.98);
      box-shadow: 0 0 22px rgba(255,215,0,0.6);
    }

    .slot {
      position: absolute;
      top: 12%;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      justify-content: center;
      gap: clamp(8px, 2vw, 16px);
      opacity: 0;
      animation: slotFade 1s ease forwards;
      animation-delay: 0.8s;
      flex-wrap: wrap;
      padding: 0 8px;
      max-width: min(100vw, 900px);
    }
    @keyframes slotFade { to { opacity: 1; } }

    .slot-box {
      width: clamp(92px, 16vw, 140px);
      height: clamp(76px, 10vw, 110px);
      background: linear-gradient(180deg,#2a1b1b,#3a0303);
      border: 2px solid var(--gold);
      border-radius: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--gold);
      font-weight: 700;
      font-size: clamp(14px, 2.2vw, 20px);
      box-shadow: 0 0 15px rgba(255,215,0,0.45);
      text-align: center;
      transition: transform .2s ease, box-shadow .2s ease, filter .2s ease;
      user-select: none;
    }
    /* 回転中のちらつき感（軽く） */
    .spinning { filter: saturate(1.2) brightness(1.1); box-shadow: 0 0 18px rgba(255,215,0,0.6); }
    .stopped  { filter: none; }

    .footer-note {
      position: absolute;
      bottom: 8px;
      color: var(--gold);
      font-size: 12px;
      text-shadow: 0 0 10px rgba(255,215,0,0.6);
      opacity: 0.85;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <h1>Unmei</h1>
  <p>出会いが鳴り、恋が奏でる運命</p>

  <div class="slot" aria-live="polite">
    <div class="slot-box" data-field="height">身長</div>
    <div class="slot-box" data-field="face">顔</div>
    <div class="slot-box" data-field="mbti">MBTI</div>
    <div class="slot-box" data-field="age">年齢</div>
    <div class="slot-box" data-field="country">国籍</div>

    <!-- ▼「血液型 / 星座 / 性別」にしたい場合は、上の2つを消して下の3つを使う
    <div class="slot-box" data-field="blood">血液型</div>
    <div class="slot-box" data-field="zodiac">星座</div>
    <div class="slot-box" data-field="gender">性別</div>
    -->
  </div>

  <button class="cta" aria-label="運命を奏でる（スタート）">運命を奏でる</button>

  <div class="keys" aria-hidden="true">
    <div class="key"></div>
    <div class="key black"></div>
    <div class="key"></div>
    <div class="key black"></div>
    <div class="key"></div>
    <div class="key"></div>
    <div class="key black"></div>
    <div class="key"></div>
    <div class="key black"></div>
    <div class="key"></div>
    <div class="key black"></div>
    <div class="key"></div>
    <div class="key"></div>
    <div class="key black"></div>
    <div class="key"></div>
    <div class="key black"></div>
    <div class="key"></div>
    <div class="key"></div>
    <div class="key black"></div>
    <div class="key"></div>
    <div class="key black"></div>
    <div class="key"></div>
    <div class="key black"></div>
    <div class="key"></div>
    <div class="key"></div>
    <div class="key black"></div>
    <div class="key"></div>
    <div class="key black"></div>
    <div class="key"></div>
  </div>

  <div class="footer-note">© 2025 Unmei Project</div>

  <script>
  (function(){
    // ===== データ定義 =====
    const faces = ["しお顔","ソース顔","とんこつ顔","砂糖顔","しょうゆ顔","塩バター顔"];
    const mbti  = ["INTJ","INFP","ENTP","ENFJ","ISTP","ISFP","ESTJ","ESFP","ISTJ","INFJ","ENTJ","ENFP","ISFJ","ESFJ","ESTP","INTP"];
    const countries = ["日本","韓国","フランス","イギリス","ドイツ","イタリア","アメリカ","ブラジル","エジプト","タイ","スペイン","カナダ","オーストラリア"];

    const bloods = ["A","B","O","AB"];
    const zodiacs = ["牡羊座","牡牛座","双子座","蟹座","獅子座","乙女座","天秤座","蠍座","射手座","山羊座","水瓶座","魚座"];
    const genders = ["女性","男性","ノンバイナリー"];

    const boxes = Array.from(document.querySelectorAll(".slot-box"));
    const keys  = Array.from(document.querySelectorAll(".keys .key"));
    const btn   = document.querySelector(".cta");

    // 結果テキスト
    const resultText = document.createElement("div");
    resultText.textContent = "あなたの運命の相手は...";
    Object.assign(resultText.style, {
      position: "absolute",
      top: "65%",
      left: "50%",
      transform: "translateX(-50%)",
      color: "var(--gold)",
      fontSize: "28px",
      letterSpacing: "3px",
      textShadow: "0 0 18px rgba(255,215,0,0.9)",
      opacity: 0,
      transition: "opacity 1.2s ease",
      pointerEvents: "none",
      textAlign: "center",
      whiteSpace: "pre-wrap"
    });
    document.body.appendChild(resultText);

    // ===== スロット回転ユーティリティ =====
    const spinners = [];
    function startSpin() {
      boxes.forEach((box, i)=>{
        box.classList.add("spinning");
        const id = setInterval(()=>{
          const field = box.dataset.field;
          switch(field){
            case "height":  box.textContent = (150 + Math.floor(Math.random()*51)) + "cm"; break; // 150-200
            case "face":    box.textContent = faces[Math.floor(Math.random()*faces.length)]; break;
            case "mbti":    box.textContent = mbti[Math.floor(Math.random()*mbti.length)]; break;
            case "age":     box.textContent = (18 + Math.floor(Math.random()*23)) + "歳"; break; // 18-40
            case "country": box.textContent = countries[Math.floor(Math.random()*countries.length)]; break;

            // ▼項目差し替え用（コメントアウトして使う）
            case "blood":   box.textContent = bloods[Math.floor(Math.random()*bloods.length)] + "型"; break;
            case "zodiac":  box.textContent = zodiacs[Math.floor(Math.random()*zodiacs.length)]; break;
            case "gender":  box.textContent = genders[Math.floor(Math.random()*genders.length)]; break;
          }
        }, 50);
        spinners[i] = id;
      });
    }
    function stopOne(index){
      if (spinners[index]) {
        clearInterval(spinners[index]);
        spinners[index] = null;
      }
      boxes[index].classList.remove("spinning");
      boxes[index].classList.add("stopped");
    }

    // ===== Web Audio：運命モチーフ風 =====
    let ac, master;
    function initAudio(){
      if (ac) return;
      ac = new (window.AudioContext || window.webkitAudioContext)();
      master = ac.createGain();
      master.gain.value = 0.18;  // 全体音量
      master.connect(ac.destination);
    }
    // G4,G4,G4,Eb4（簡易）＋休符
    const motif = [
      {freq:392, dur:0.28}, {rest:0.08},
      {freq:392, dur:0.28}, {rest:0.08},
      {freq:392, dur:0.28}, {rest:0.14},
      {freq:311, dur:0.44}, {rest:0.32}
    ];
    function playTone(freq, start, dur, type="square"){
      const osc = ac.createOscillator();
      const g = ac.createGain();
      osc.type = type;
      osc.frequency.setValueAtTime(freq, start);
      g.gain.setValueAtTime(0, start);
      g.gain.linearRampToValueAtTime(1, start+0.02);
      g.gain.linearRampToValueAtTime(0.0001, start+dur);
      osc.connect(g); g.connect(master);
      osc.start(start);
      osc.stop(start+dur+0.03);
    }

    function playFateAndStopSequence(){
      initAudio();
      // iOS/Safari対策：resume 必須な場合がある
      if (ac.state === "suspended") { ac.resume(); }

      const t0 = ac.currentTime + 0.05;
      let cursor = t0;
      let stopIndex = 0;

      motif.forEach(step=>{
        if (step.freq){
          playTone(step.freq, cursor, step.dur, step.freq===311 ? "sawtooth" : "square");

          // ランダム鍵盤を光らせる
          const k = keys[Math.floor(Math.random()*keys.length)];
          if (k){
            setTimeout(()=>{
              k.classList.add("flash");
              setTimeout(()=>k.classList.remove("flash"), 120);
            }, Math.max(0, (cursor - ac.currentTime)*1000));
          }

          // 音の終わりでスロットを順停止
          setTimeout(()=>{
            if (stopIndex < boxes.length){
              stopOne(stopIndex++);
            }
          }, Math.max(0, (cursor + step.dur - ac.currentTime)*1000));

          cursor += step.dur;
        } else if (step.rest){
          cursor += step.rest;
        }
      });

      // 最後の余韻で全停止→「あなたの運命の相手は…」フェードイン
      setTimeout(()=>{
        while (stopIndex < boxes.length){ stopOne(stopIndex++); }
        setTimeout(()=>{ resultText.style.opacity = 1; }, 300);
      }, Math.max(0, (cursor - ac.currentTime + 0.30)*1000));
    }

    // ===== クリックで開始 =====
    let running = false;
    btn.addEventListener("click", async ()=>{
      if (running) return;
      running = true;
      resultText.style.opacity = 0;               // 毎回リセット
      boxes.forEach(b=>b.classList.remove("stopped"));

      startSpin();                                 // 1) スロット回転
      playFateAndStopSequence();                   // 2) モチーフ再生＆順停止

      // 数秒後に再プレイ可能に
      setTimeout(()=>{ running = false; }, 6000);
    });

    // キーボード操作でも開始できるように（Enter/Space）
    btn.addEventListener("keydown",(e)=>{
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        btn.click();
      }
    });
  })();
  </script>
</body>
</html>
