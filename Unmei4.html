<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Unmei - å‡ºä¼šã„ãŒé³´ã‚Šã€æ‹ãŒå¥ã§ã‚‹é‹å‘½</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

<style>
  :root { --gold:#ffd700; }
  * { box-sizing:border-box }
  body{
    margin:0;height:100vh;overflow:hidden;
    display:flex;flex-direction:column;justify-content:center;align-items:center;
    background:radial-gradient(circle at center,#1c0d0d 0%,#000 80%);
    font-family:'Playfair Display',serif;
  }
  h1{font-size:clamp(40px,8vw,72px);color:var(--gold);text-shadow:0 0 25px rgba(255,215,0,1);letter-spacing:3px;margin:24px 16px 8px;animation:fadeIn 1.2s ease forwards}
  p{font-size:clamp(14px,2.5vw,22px);color:var(--gold);letter-spacing:2px;margin:0 16px 8px;text-align:center;text-shadow:0 0 15px rgba(255,215,0,0.8);opacity:0;animation:subtitle 1s ease .5s forwards}
  @keyframes fadeIn{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:translateY(0)}}
  @keyframes subtitle{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

  .slot{position:absolute;top:12%;left:50%;transform:translateX(-50%);
        display:flex;gap:clamp(8px,2vw,16px);flex-wrap:wrap;max-width:min(100vw,900px);padding:0 8px;opacity:0;animation:slotFade 1s ease .8s forwards}
  @keyframes slotFade{to{opacity:1}}
  .slot-box{
    width:clamp(92px,16vw,140px);height:clamp(76px,10vw,110px);
    background:linear-gradient(180deg,#2a1b1b,#3a0303);border:2px solid var(--gold);border-radius:12px;
    color:var(--gold);font-weight:700;font-size:clamp(14px,2.2vw,20px);
    display:flex;align-items:center;justify-content:center;text-align:center;
    box-shadow:0 0 15px rgba(255,215,0,0.45);transition:filter .2s,box-shadow .2s;user-select:none
  }
  .spinning{filter:saturate(1.2) brightness(1.1);box-shadow:0 0 18px rgba(255,215,0,0.6)}
  .stopped{filter:none}

  .keys{position:absolute;bottom:0;left:50%;transform:translateX(-50%);display:flex;gap:2px;padding:8px 0 10px;pointer-events:none}
  .key{width:64px;height:280px;background:linear-gradient(to bottom,#fff,#ddd);border:1px solid #444;border-radius:4px;position:relative;animation:play 6s infinite ease-in-out;box-shadow:0 4px 10px rgba(255,255,255,0.08)}
  .key.black{width:42px;height:180px;background:linear-gradient(to bottom,#111,#000);margin:0 -21px;z-index:2;border-color:#222;box-shadow:0 4px 10px rgba(0,0,0,0.35);animation:playBlack 6s infinite ease-in-out}
  @keyframes play{0%,100%{filter:brightness(1)}50%{filter:brightness(1.6)}}
  @keyframes playBlack{0%,100%{filter:brightness(1)}50%{filter:brightness(1.3)}}
  .flash{box-shadow:0 0 22px rgba(255,215,0,0.9)!important;filter:brightness(2) saturate(1.2)}

  button.cta{
    position:relative;z-index:5;margin-top:clamp(16px,6vh,100px);
    background:linear-gradient(90deg,#8b0000,#b30000);color:var(--gold);border:2px solid var(--gold);border-radius:12px;
    padding:14px 36px;font-size:clamp(16px,3.4vw,24px);cursor:pointer;text-shadow:0 0 12px rgba(255,215,0,0.8);
    box-shadow:0 0 25px rgba(255,215,0,0.35);transition:transform .25s,box-shadow .25s,filter .25s
  }
  button.cta:hover{transform:translateY(-1px) scale(1.04);box-shadow:0 0 35px rgba(255,215,0,0.8);filter:brightness(1.05)}
  button.cta:active{transform:translateY(0) scale(0.98);box-shadow:0 0 22px rgba(255,215,0,0.6)}

  .footer-note{position:absolute;bottom:8px;color:var(--gold);font-size:12px;text-shadow:0 0 10px rgba(255,215,0,0.6);opacity:.85}

  .result-line,.result-summary{
    position:absolute;left:50%;transform:translateX(-50%);
    color:var(--gold);text-shadow:0 0 18px rgba(255,215,0,0.9);opacity:0;transition:opacity .9s ease;
    text-align:center;white-space:pre-wrap;letter-spacing:2px
  }
  .result-line{top:65%;font-size:28px}
  .result-summary{top:74%;font-size:22px}
  .show{opacity:1}

  /* ç”»é¢å†…ã‚¨ãƒ©ãƒ¼è¡¨ç¤º */
  .toast{
    position:fixed;top:10px;left:50%;transform:translateX(-50%);
    background:#300;color:#ffdede;border:1px solid #f88;padding:8px 12px;border-radius:8px;
    font-size:14px;box-shadow:0 6px 20px rgba(0,0,0,.3);z-index:9999;max-width:90vw
  }
</style>
</head>
<body>
  <h1>Unmei</h1>
  <p>å‡ºä¼šã„ãŒé³´ã‚Šã€æ‹ãŒå¥ã§ã‚‹é‹å‘½</p>

  <div class="slot" aria-live="polite">
    <div class="slot-box" data-field="height">èº«é•·</div>
    <div class="slot-box" data-field="face">é¡”</div>
    <div class="slot-box" data-field="mbti">MBTI</div>
    <div class="slot-box" data-field="age">å¹´é½¢</div>
    <div class="slot-box" data-field="country">å›½ç±</div>
  </div>

  <button class="cta" aria-label="é‹å‘½ã‚’å¥ã§ã‚‹ï¼ˆã‚¹ã‚¿ãƒ¼ãƒˆï¼‰">é‹å‘½ã‚’å¥ã§ã‚‹</button>

  <!-- ğŸ”Š MP4ã‚’videoã§å†ç”Ÿï¼ˆè¡¨ç¤ºã¯éš ã™ï¼‰ -->
  <video id="bgm" preload="auto" playsinline style="position:absolute; width:1px; height:1px; opacity:0; pointer-events:none;">
    <!-- å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã©ã¡ã‚‰ã‚‚è©¦ã™ï¼ˆã©ã¡ã‚‰ã‹1ã¤ã‚’æ®‹ã—ã¦OKï¼‰ -->
    <source src="v14025g50000cn30p8nog65tnccspi1g.MP4" type="video/mp4" />
    <source src="v14025g50000cn30p8nog65tnccspi1g.mp4" type="video/mp4" />
  </video>

  <div class="keys" aria-hidden="true">
    <div class="key"></div><div class="key black"></div><div class="key"></div><div class="key black"></div>
    <div class="key"></div><div class="key"></div><div class="key black"></div><div class="key"></div><div class="key black"></div>
    <div class="key"></div><div class="key black"></div><div class="key"></div><div class="key"></div><div class="key black"></div>
    <div class="key"></div><div class="key black"></div><div class="key"></div><div class="key"></div><div class="key black"></div>
    <div class="key"></div><div class="key black"></div><div class="key"></div><div class="key black"></div>
    <div class="key"></div><div class="key"></div><div class="key black"></div><div class="key"></div><div class="key black"></div><div class="key"></div>
  </div>

  <div class="footer-note">Â© 2025 Unmei Project</div>

<script>
(function(){
  // ===== ãƒ‡ãƒ¼ã‚¿ =====
  const faces = ["ã—ãŠé¡”","ã‚½ãƒ¼ã‚¹é¡”","ã¨ã‚“ã“ã¤é¡”","ç ‚ç³–é¡”","ã—ã‚‡ã†ã‚†é¡”","å¡©ãƒã‚¿ãƒ¼é¡”"];
  const mbti  = ["INTJ","INFP","ENTP","ENFJ","ISTP","ISFP","ESTJ","ESFP","ISTJ","INFJ","ENTJ","ENFP","ISFJ","ESFJ","ESTP","INTP"];
  const countries = ["æ—¥æœ¬","éŸ“å›½","ãƒ•ãƒ©ãƒ³ã‚¹","ã‚¤ã‚®ãƒªã‚¹","ãƒ‰ã‚¤ãƒ„","ã‚¤ã‚¿ãƒªã‚¢","ã‚¢ãƒ¡ãƒªã‚«","ãƒ–ãƒ©ã‚¸ãƒ«","ã‚¨ã‚¸ãƒ—ãƒˆ","ã‚¿ã‚¤","ã‚¹ãƒšã‚¤ãƒ³","ã‚«ãƒŠãƒ€","ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢"];

  const boxes = Array.from(document.querySelectorAll(".slot-box"));
  const keys  = Array.from(document.querySelectorAll(".keys .key"));
  const btn   = document.querySelector(".cta");
  const bgm   = document.getElementById("bgm");

  // ===== çµæœãƒ†ã‚­ã‚¹ãƒˆ =====
  const line = document.createElement("div");
  line.className = "result-line";
  line.textContent = "ã‚ãªãŸã®é‹å‘½ã®ç›¸æ‰‹ã¯...";
  document.body.appendChild(line);

  const summary = document.createElement("div");
  summary.className = "result-summary";
  document.body.appendChild(summary);

  // ===== ã‚­ãƒ¥ãƒ¼ï¼ˆmsï¼‰ =====
  const cues = {
    line:     1500,
    height:   4200,
    face:     7500,
    mbti:     9800,
    age:     12100,
    country:  14500,
    summary:  17500
  };

  // ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ =====
  const timeouts = [];
  const spinners = [];
  function toast(msg){
    const t=document.createElement("div"); t.className="toast"; t.textContent=msg; document.body.appendChild(t);
    setTimeout(()=>t.remove(), 6000);
  }
  function clearAllTimeouts(){ while(timeouts.length){ clearTimeout(timeouts.pop()); } }
  function schedule(fn, delayMs, startMs){
    const h=setTimeout(fn, Math.max(0, startMs + delayMs - performance.now())); timeouts.push(h);
  }
  function flashKey(){
    const k = keys[Math.floor(Math.random()*keys.length)];
    if(!k) return; k.classList.add("flash"); setTimeout(()=>k.classList.remove("flash"), 120);
  }
  function startSpin(){
    boxes.forEach((box)=>{
      box.classList.add("spinning");
      const id=setInterval(()=>{
        const f=box.dataset.field;
        switch(f){
          case "height":  box.textContent=(150+Math.floor(Math.random()*51))+"cm"; break;
          case "face":    box.textContent=faces[Math.floor(Math.random()*faces.length)]; break;
          case "mbti":    box.textContent=mbti[Math.floor(Math.random()*mbti.length)]; break;
          case "age":     box.textContent=(18+Math.floor(Math.random()*23))+"æ­³"; break;
          case "country": box.textContent=countries[Math.floor(Math.random()*countries.length)]; break;
        }
      }, 45);
      spinners.push(id);
    });
  }
  function stopBox(index){
    if (spinners[index]) { clearInterval(spinners[index]); spinners[index]=null; }
    boxes[index].classList.remove("spinning");
    boxes[index].classList.add("stopped");
    flashKey();
    return boxes[index].textContent;
  }

  // ===== äº‹å‰ãƒ­ãƒ¼ãƒ‰ç¢ºèªï¼ˆGitHub Pagesã®ãƒ‘ã‚¹/å¤§å°å¯¾ç­–ï¼‰ =====
  function ensureSourceExists(){
    // ã©ã¡ã‚‰ã‹ç‰‡æ–¹ã®<source>ã ã‘ç”Ÿãæ®‹ã‚‰ã›ã¦ã‚‚OK
    const sources = bgm.querySelectorAll("source");
    sources.forEach(s=>{
      const img = new Image(); // HEADãƒªã‚¯ã‚¨ã‚¹ãƒˆä»£ã‚ã‚Š
      img.onload = ()=>{}; img.onerror = ()=>{
        // ç‰‡æ–¹ãŒ404ãªã‚‰å‰Šé™¤ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ãŒå­˜åœ¨ã™ã‚‹æ–¹ã‚’é¸ã³ã‚„ã™ãï¼‰
        s.remove();
      };
      img.src = s.src; // ç”»åƒã¨ã—ã¦ã¯å¤±æ•—ã™ã‚‹ãŒã€404æ¤œå‡ºç”¨ã®ç°¡æ˜“ãƒˆãƒªãƒƒã‚¯
    });
  }

  // ===== å®Ÿè¡Œã‚·ãƒ¼ã‚±ãƒ³ã‚¹ =====
  async function runSequence(){
    clearAllTimeouts();
    summary.textContent="";
    line.classList.remove("show");
    summary.classList.remove("show");
    boxes.forEach(b=>b.classList.remove("stopped"));
    spinners.splice(0).forEach(id=>clearInterval(id));

    ensureSourceExists();

    // Audioã®èª­ã¿è¾¼ã¿å®Œäº†ã‚’å¾…ã£ã¦ã‹ã‚‰å†ç”Ÿï¼†æ¼”å‡ºé–‹å§‹
    try{
      await new Promise((resolve, reject)=>{
        const ok=()=>{ bgm.removeEventListener("canplaythrough",ok); resolve(); };
        const fail=()=>{ bgm.removeEventListener("error",fail); reject(new Error("éŸ³æºã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ")); };
        bgm.addEventListener("canplaythrough", ok, {once:true});
        bgm.addEventListener("error", fail, {once:true});
        // æ—¢ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹å ´åˆ
        if(bgm.readyState>=3){ resolve(); }
      });
    }catch(e){
      toast("éŸ³æºãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã€‚ãƒ•ã‚¡ã‚¤ãƒ«åã‚„é…ç½®ãƒ•ã‚©ãƒ«ãƒ€ã€æ‹¡å¼µå­ã®å¤§æ–‡å­—/å°æ–‡å­—ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
      return;
    }

    try{
      bgm.pause();
      bgm.currentTime = 0;
      await bgm.play(); // ã‚¯ãƒªãƒƒã‚¯èµ·ç‚¹ãªã®ã§ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚OK
    }catch(e){
      toast("å†ç”ŸãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚");
      return;
    }

    startSpin();
    const start = performance.now();

    schedule(()=>{ line.classList.add("show"); }, cues.line, start);

    let picked={height:"",face:"",mbti:"",age:"",country:""};
    schedule(()=>{ picked.height  = stopBox(0); }, cues.height,  start);
    schedule(()=>{ picked.face    = stopBox(1); }, cues.face,    start);
    schedule(()=>{ picked.mbti    = stopBox(2); }, cues.mbti,    start);
    schedule(()=>{ picked.age     = stopBox(3); }, cues.age,     start);
    schedule(()=>{ picked.country = stopBox(4); }, cues.country, start);

    schedule(()=>{
      const label = `${picked.country} / ${picked.height} / ${picked.face} / ${picked.mbti} / ${picked.age}`;
      summary.textContent = `ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼\n${label}\nãŒé‹å‘½ã®ç›¸æ‰‹ã§ã™ã€‚`;
      summary.classList.add("show");
    }, cues.summary, start);
  }

  // ===== ãƒœã‚¿ãƒ³ =====
  let busy=false;
  btn.addEventListener("click", async ()=>{
    if(busy) return; busy=true;
    await runSequence();
    setTimeout(()=>busy=false, 22000);
  });

  // ===== ãƒšãƒ¼ã‚¸é·ç§»æ™‚å¾Œç‰‡ä»˜ã‘ =====
  window.addEventListener("pagehide", ()=>{ bgm.pause(); clearAllTimeouts(); });
  window.addEventListener("beforeunload", ()=>{ bgm.pause(); clearAllTimeouts(); });
})();
</script>
</body>
</html>
